
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="toolchain.html">
      
      
        <link rel="next" href="align.html">
      
      <link rel="icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>move - Cat538's Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#move" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Cat538&#39;s Blog" class="md-header__button md-logo" aria-label="Cat538's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cat538's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              move
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Cat538&#39;s Blog" class="md-nav__button md-logo" aria-label="Cat538's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cat538's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Prologue
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plan.html" class="md-nav__link">
        Exercise
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Cpp
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Cpp
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="toolchain.html" class="md-nav__link">
        toolchain
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          move
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="move.html" class="md-nav__link md-nav__link--active">
        move
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lvalues-and-rvalues" class="md-nav__link">
    Lvalues and Rvalues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rvalue-reference" class="md-nav__link">
    Rvalue Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#move_1" class="md-nav__link">
    Move çš„è®¾è®¡
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forwarding-reference" class="md-nav__link">
    Forwarding Reference
  </a>
  
    <nav class="md-nav" aria-label="Forwarding Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference-collapsing" class="md-nav__link">
    å¼•ç”¨æŠ˜å (Reference collapsing)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stdforawrd" class="md-nav__link">
    std::forawrd()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="align.html" class="md-nav__link">
        align
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ranges.html" class="md-nav__link">
        ranges
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="benchmark.html" class="md-nav__link">
        benchmark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="profiler.html" class="md-nav__link">
        profiler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="IO-multiplexing.html" class="md-nav__link">
        IO-multiplexing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="epoll.html" class="md-nav__link">
        epoll
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="signal.html" class="md-nav__link">
        signal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="fork-safe.html" class="md-nav__link">
        fork-safe
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Rust
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Rust
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-toolchain.html" class="md-nav__link">
        rust-toolchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-study.html" class="md-nav__link">
        rust-study
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-attributes.html" class="md-nav__link">
        rust-attributes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-modules.html" class="md-nav__link">
        rust-modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-macro.html" class="md-nav__link">
        rust-macro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-network.html" class="md-nav__link">
        rust-network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-option.html" class="md-nav__link">
        rust-optin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/rust-str.html" class="md-nav__link">
        rust-str
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/cmake.html" class="md-nav__link">
        cmake
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/docker.html" class="md-nav__link">
        docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/git.html" class="md-nav__link">
        git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/powershell.html" class="md-nav__link">
        powershell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/regex.html" class="md-nav__link">
        regex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/mkdocs.html" class="md-nav__link">
        mkdocs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Courses
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Courses
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/%E5%AF%86%E7%A0%81%E5%88%86%E6%9E%90%E5%AD%A6%E5%A4%8D%E4%B9%A0.html" class="md-nav__link">
        å¯†ç åˆ†æå­¦
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%BC%95%E8%AE%BA%E5%A4%8D%E4%B9%A0.html" class="md-nav__link">
        å¯†ç å­¦å¼•è®º
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/algorithm.html" class="md-nav__link">
        ç®—æ³•è®¾è®¡ä¸åˆ†æ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html" class="md-nav__link">
        ç¼–è¯‘åŸç†
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Crypto
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Crypto
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/ecdsa-pk-recovery.html" class="md-nav__link">
        ecdsa-pk-recovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/algo-rsa.html" class="md-nav__link">
        algo-rsa
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/algo-fft%26ntt.html" class="md-nav__link">
        algo-fft&ntt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/algo-reduction.html" class="md-nav__link">
        algo-reduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Mlc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Mlc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/dlc-survey.html" class="md-nav__link">
        dlc-survey
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-install.html" class="md-nav__link">
        tvm-install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-ffi.html" class="md-nav__link">
        tvm-ffi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-type.html" class="md-nav__link">
        tvm-type
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-tensorIR.html" class="md-nav__link">
        tvm-tensorIR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-lowering.html" class="md-nav__link">
        tvm-lowering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-autotvm.html" class="md-nav__link">
        tvm-autotvm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-ansor.html" class="md-nav__link">
        tvm-ansor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir.html" class="md-nav__link">
        mlir
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir-toy.html" class="md-nav__link">
        mlir-toy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir-onnx.html" class="md-nav__link">
        mlir-onnx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir-iree.html" class="md-nav__link">
        mlir-iree
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-torch.fx.html" class="md-nav__link">
        paper-torch.fx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-nimble.html" class="md-nav__link">
        paper-nimble
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-disc.html" class="md-nav__link">
        paper-disc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-cortex.html" class="md-nav__link">
        paper-cortex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-freetensor.html" class="md-nav__link">
        paper-freetensor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about.html" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lvalues-and-rvalues" class="md-nav__link">
    Lvalues and Rvalues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rvalue-reference" class="md-nav__link">
    Rvalue Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#move_1" class="md-nav__link">
    Move çš„è®¾è®¡
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forwarding-reference" class="md-nav__link">
    Forwarding Reference
  </a>
  
    <nav class="md-nav" aria-label="Forwarding Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference-collapsing" class="md-nav__link">
    å¼•ç”¨æŠ˜å (Reference collapsing)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stdforawrd" class="md-nav__link">
    std::forawrd()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="move">Move</h1>
<h2 id="lvalues-and-rvalues">Lvalues and Rvalues</h2>
<blockquote>
<p>Ref:</p>
<ul>
<li><a href="https://radekvit.medium.com/move-semantics-in-c-and-rust-the-case-for-destructive-moves-d816891c354b">Move semantics in C++ and Rust: The case for destructive moves</a></li>
<li><a href="https://learn.microsoft.com/en-us/cpp/cpp/move-constructors-and-move-assignment-operators-cpp?view=msvc-170">MS: How to write a move constructor and move assignment operator</a></li>
</ul>
</blockquote>
<p>åœ¨ C++ ä¸­ï¼Œæ¯ä¸ªè¡¨è¾¾å¼ä¸ä»…æœ‰ä¸€ä¸ªtypeï¼Œè¿˜æœ‰ä¸€ä¸ªvalue categoryã€‚<strong>æ³¨æ„è¿™ä¸¤è€…æ˜¯ä¸åŒçš„æ¦‚å¿µï¼Œä¸€ä¸ªtypeä¸º rvalue reference (T&amp;&amp;)çš„å€¼ï¼Œå®ƒçš„value categoryå¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ã€‚</strong> cppä¸­æœ‰ä¸‰ä¸ªä¸»è¦çš„value categoryå’Œä¸¤ä¸ªæ··åˆç±»å‹value categoryã€‚æ¯ä¸ªè¡¨è¾¾å¼éƒ½æœ‰ä¸€ä¸ªä¸»è¦çš„value categoryï¼Œå®ƒå†³å®šäº†è¯­è¨€å°†å¦‚ä½•å¤„ç†å®ƒä¸å…¶ä»–è¡¨è¾¾å¼çš„å…³ç³»ã€‚</p>
<ul>
<li><strong>lvalue</strong>: ç®€å•åœ°è¯´ï¼Œ <strong>lvalue</strong> æ˜¯ä¸€ä¸ªå˜é‡ï¼›<strong>æœ‰åå­—</strong>ï¼Œ<strong>å¯ä»¥å–å†…å­˜åœ°å€</strong></li>
<li><strong>xvalue</strong>: å°±åƒä¸€ä¸ª <strong>lvalue</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬å£°æ˜<u>è¿™ä¸ªå˜é‡æ‹¥æœ‰çš„èµ„æºå¯ä»¥è½¬ç§»ç»™ä¸€ä¸ªæ–°çš„æ‰€æœ‰è€…</u></li>
<li><strong>prvalue</strong>: æ²¡æœ‰åç§°çš„ä¸´æ—¶å€¼ï¼Œ<strong>æ— æ³•å–åœ°å€</strong></li>
<li><strong>glvalue</strong> (mixed) is either an <strong>lvalue</strong> or an <strong>xvalue</strong>.</li>
<li><strong>rvalue</strong> (mixed) is either an <strong>xvalue</strong> or a <strong>prvalue</strong>.</li>
</ul>
<div class="autocb" style="text-align:center;"><img src="./move.assets\autocb_0.png" style="zoom: 50%;box-shadow: rgba(0, 0, 0, 0.5) 10px 10px 10px; border-radius: 10px;" /></div>

<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">{</span><span class="s">&quot;value categories&quot;</span><span class="p">};</span>
<span class="c1">// `i` is an lvalue</span>
<span class="c1">// `std::move(i)` is an xvalue</span>
<span class="c1">// `static_cast&lt;std::string&amp;&amp;&gt;(i)` is an xvalue</span>
<span class="c1">// `std::string{&quot;value categories&quot;}` is a prvalue (pure rvalue)</span>
</code></pre></div>
<h2 id="rvalue-reference">Rvalue Reference</h2>
<p>é¡¾åæ€ä¹‰ï¼Œ<strong>rvalue reference</strong> æ˜¯æŒ‡å‘<strong>rvalue</strong>çš„å¼•ç”¨ã€‚</p>
<p>é€šè¿‡å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åŒºåˆ†å·¦å€¼å’Œå³å€¼ï¼šå› ä¸ºå³å€¼å¼•ç”¨åªèƒ½ç»‘å®šå³å€¼(rvalue)ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä¼ è¿›åˆ°è¯¥å‡½æ•°çš„å‚æ•°ä¸€å®šæ˜¯å³å€¼ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ss</span><span class="p">){</span>
<span class="w">  </span><span class="n">bar</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">ss</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¾‹å¦‚ä¸Šè¿°ä»£ç ä¸­çš„<code>foo</code>ï¼Œ<strong>è¿™é‡Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬èƒ½å¤ŸçŸ¥é“<code>ss</code>æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå› æ­¤ä»»ä½•èƒ½ç»‘å®šåˆ°å®ƒçš„ä¸œè¥¿ï¼ˆå³ä»»ä½•èƒ½ä¼ è¿›<code>foo</code>è¿™ä¸ªå‡½æ•°çš„å‚æ•°ï¼‰éƒ½æ˜¯å³å€¼</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»<code>ss</code>ä¸­çªƒå–èµ„æºï¼ˆä½†æ˜¯è¿™é‡Œæ³¨æ„ï¼Œå…·åå³å€¼å¼•ç”¨çš„å€¼ç±»åˆ«æ˜¯å·¦å€¼ï¼Œå› æ­¤éœ€è¦<code>std::move</code>å°†<code>ss</code>ä½œä¸ºå³å€¼å¯¹å¾…ï¼Œåé¢ä¼šå†æ¬¡æåˆ°ï¼‰</p>
<p>æœ€å¸¸è§çš„æ˜¯ move constructorï¼Œè¿™é‡Œç”¨ copy constructor ä½œä¸ºå¯¹æ¯”ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">MyData</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">data1</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">data2</span><span class="p">;</span>
<span class="w">    </span><span class="n">MyData</span><span class="p">()</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// this is (basically) what the compiler will generate for you</span>
<span class="w">    </span><span class="c1">// never write these by hand unless you&#39;re managing resources</span>
<span class="w">    </span><span class="c1">// copy constructor</span>
<span class="w">    </span><span class="n">MyData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MyData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">data1</span><span class="p">{</span><span class="n">other</span><span class="p">.</span><span class="n">data1</span><span class="p">}</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">data2</span><span class="p">{</span><span class="n">other</span><span class="p">.</span><span class="n">data1</span><span class="p">}</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// copy assignment</span>
<span class="w">    </span><span class="n">MyData</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MyData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">data1</span><span class="p">;</span>
<span class="w">         </span><span class="n">data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">data2</span><span class="p">;</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// move constructor</span>
<span class="w">    </span><span class="n">MyData</span><span class="p">(</span><span class="n">MyData</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">data1</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data1</span><span class="p">)}</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">data2</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data1</span><span class="p">)}</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// move assignment</span>
<span class="w">    </span><span class="n">MyData</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">MyData</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data1</span><span class="p">);</span>
<span class="w">         </span><span class="n">data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data2</span><span class="p">);</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>ç®¡ç†èµ„æºçš„ç±»ï¼Œå¦‚ <code>std::vector&lt;T&gt;</code>ã€<code>std::string</code>ï¼Œé€šå¸¸ä¼šåœ¨å®ƒä»¬çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šä¸åˆ†é…æ–°å†…å­˜ï¼Œè€Œæ˜¯ä»æ­£åœ¨æ„é€ çš„ rvalue ä¸­è·å–å·²ç»åˆ†é…çš„ç¼“å†²åŒºï¼Œå¹¶ç•™ä¸‹ä¸€äº›æœ‰æ•ˆçš„ä»·å€¼æ¥ä»£æ›¿å®ƒã€‚move assignment é€šå¸¸ä¼šç®€å•åœ°å°†åˆ†é…çš„èµ„æºä¸å³å€¼äº¤æ¢ï¼Œåœ¨èµ‹å€¼è°ƒç”¨åå®ƒä»¬å°†è¢«ç§»å‡ºçš„å³å€¼é‡Šæ”¾ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">almost_vector</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">data_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">buffer_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">almost_vector</span><span class="p">()</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">    </span><span class="n">almost_vector</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">almost_vector</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// allocate buffer, copy elements</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">almost_vector</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">almost_vector</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// allocate new buffer, copy elements</span>
<span class="w">        </span><span class="c1">// swap the buffers</span>
<span class="w">        </span><span class="c1">// deallocate the old buffer</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// the move constructor will do something like this</span>
<span class="w">    </span><span class="n">almost_vector</span><span class="p">(</span><span class="n">almost_vector</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">buffer</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">data_end</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">data_end</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">buffer_end</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">buffer_end</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// move assignment will do something like this</span>
<span class="w">    </span><span class="n">almost_vector</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">almost_vector</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">buffer</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">data_end</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">data_end</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">buffer_end</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">buffer_end</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>ğŸ’¡<strong>rvalue reference</strong>æœ‰ä¸ç›´è§‚çš„ä¸€é¢ï¼š</p>
<ul>
<li><code>std::move(data)</code> ä»…ä»…åªå°†dataçš„ç±»å‹å¼ºåˆ¶è½¬æ¢ä¸º<code>T&amp;&amp;</code>ï¼›ä¸è¦æƒ³è±¡<code>std::move()</code>ä¼šé”€æ¯<code>data</code>æˆ–è€…ä¿®æ”¹dataçš„å†…å­˜ç­‰ç­‰</li>
<li>
<p><strong>å…·åå³å€¼å¼•ç”¨æ˜¯å·¦å€¼</strong>ï¼š<code>string&amp;&amp; s2 = std::move(s1)</code>ï¼Œè¿™é‡Œ<code>s2</code> çš„ value category æ˜¯ lvalueï¼›å¦‚æœæœ‰å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">{</span><span class="s">&quot;123&quot;</span><span class="p">};</span>
<span class="n">string</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">;</span><span class="w"> </span><span class="c1">// è¿™é‡Œè°ƒç”¨çš„æ˜¯ copy constructor</span>
</code></pre></div>
<p>å¦‚ä»£ç ä¸­æ³¨é‡Šæ‰€ç¤ºï¼Œç¬¬ä¸‰è¡Œå°†ä¼šè°ƒç”¨<code>std::string</code>çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºè¿™é‡Œçš„<code>s2</code>è™½ç„¶å€¼ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œ<strong>ä½†å®ƒçš„å€¼ç±»åˆ«æ˜¯å·¦å€¼</strong>ï¼Œæ ¹æ®<a href="https://en.cppreference.com/w/cpp/language/move_constructor">Move constructors</a>ä¸­ Noteä¸€èŠ‚ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œæ­¤æ—¶ä¼šé€‰æ‹©copy constructor</p>
<blockquote>
<p>If both copy and move constructors are provided and no other constructors are viable, overload resolution selects the move constructor if the argument is an rvalue of the same type (an xvalue such as the result of std::move or a prvalue such as a nameless temporary (until C++17)), and <strong>selects the copy constructor if the argument is an lvalue</strong> (named object or a function/operator returning lvalue reference).
- å³å€¼å¼•ç”¨åªèƒ½ç»‘å®šå³å€¼ï¼Œå·¦å€¼å¼•ç”¨(non-const)åªèƒ½ç»‘å®šå·¦å€¼ï¼Œ<strong>const lvalue referenceæ—¢å¯ä»¥ç»‘å®šå·¦å€¼ï¼Œåˆå¯ä»¥ç»‘å®šå³å€¼</strong>ï¼›<a href="https://stackoverflow.com/questions/58062090/why-is-it-possible-to-pass-an-rvalue-by-const-lvalue-reference">c++ - Why is it possible to pass an rvalue by const lvalue reference? - Stack Overflow</a></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">{</span><span class="s">&quot;abc&quot;</span><span class="p">};</span>
<span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">  </span><span class="c1">// error! std::move(s) is xvalue</span>
<span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">{</span><span class="s">&quot;123&quot;</span><span class="p">};</span><span class="w"> </span><span class="c1">// error! string{&quot;123&quot;} is prvalue</span>
<span class="n">string</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">    </span><span class="c1">// error! s is lvalue</span>
<span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">s4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">{</span><span class="s">&quot;123&quot;</span><span class="p">};</span><span class="w">  </span><span class="c1">// ok</span>
<span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">s5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">              </span><span class="c1">// ok</span>
<span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">s6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">   </span><span class="c1">// ok</span>
</code></pre></div>
</li>
</ul>
<p>é™¤äº†<strong>lvalue reference</strong>å’Œ<strong>rvalue reference</strong>ä¹‹å¤–ï¼ŒC++ ä¸­è¿˜å­˜åœ¨ç¬¬ä¸‰ç§å¼•ç”¨ï¼š<strong>the forwarding reference</strong>ã€‚åœ¨æ¨¡æ¿å‡½æ•°ä¸­ï¼Œ<code>T&amp;&amp;</code> æˆä¸ºè½¬å‘å¼•ç”¨è€Œä¸æ˜¯å³å€¼å¼•ç”¨ï¼Œå¦å¤–ï¼Œ<code>auto&amp;&amp;</code> å§‹ç»ˆæ˜¯è½¬å‘å¼•ç”¨ã€‚è½¬å‘å¼•ç”¨ä¿ç•™å®ƒä»¬åˆå§‹åŒ–æ—¶ä½¿ç”¨çš„è¡¨è¾¾å¼çš„å€¼ç±»åˆ«ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¼ é€’ç»™å…¶ä»–å‡½æ•°æ—¶ä¿ç•™ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">baz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">);</span>
<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Templated</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// t is an rvalue referenceï¼Œ å¯ä»¥æƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆğŸ‰</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// u is a forwarding reference</span>
<span class="w">    </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">bar</span><span class="p">(</span><span class="n">U</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// forward to another function</span>
<span class="w">        </span><span class="c1">// x is a forwarding reference</span>
<span class="w">        </span><span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">u</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>æ›´è¯¦ç»†çš„å†…å®¹è§<a href="#perfect-forwarding">Perfect forwarding</a></p>
<h2 id="move_1">Move çš„è®¾è®¡</h2>
<p>ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯ï¼Œobject è¢« move ä¹‹åï¼Œå¤„äºä»€ä¹ˆçŠ¶æ€ï¼Ÿ</p>
<p>C++ æ ‡å‡†åº“é€‰æ‹©å°†ç§»å‡ºçš„å˜é‡ä¿æŒåœ¨æœ‰æ•ˆä½†æœªæŒ‡å®šçš„çŠ¶æ€(valid but unspecified state)ï¼›è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é‡ç”¨å˜é‡ï¼Œæˆ‘ä»¬åªæ˜¯ä¸èƒ½ä¾èµ–å®ƒçš„å†…å®¹ã€‚ </p>
<p>ç§»åŠ¨çš„å˜é‡åœ¨ C++ ä¸­ç§»åŠ¨åä»ç„¶å¯ç”¨ã€‚å˜é‡çš„ææ„å‡½æ•°å°†åœ¨è¿™äº›å˜é‡åˆ°è¾¾å…¶ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶è¿è¡Œï¼Œç”¨æˆ·å¯ä»¥ä¸ºå®ƒä»¬èµ‹å€¼ï¼Œæˆ–è°ƒç”¨å®ƒä»¬çš„ä»»ä½•æˆå‘˜å‡½æ•°ã€‚ </p>
<p>å¯¹äºç”¨æˆ·å£°æ˜çš„ç±»å‹ï¼Œå”¯ä¸€çœŸæ­£çš„è¦æ±‚æ˜¯ç§»å‡ºå˜é‡çš„ææ„å‡½æ•°å¿…é¡»åœ¨è¿è¡Œæ—¶ä¸ä¼šå¯¹ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†é€ æˆä»»ä½•é—®é¢˜ã€‚ç±»å‹çš„ä»»ä½•ä¸å˜é‡éƒ½å¯èƒ½è¢«ç ´åï¼Œå¹¶ä¸”åœ¨å®ƒä»¬ä¸Šè°ƒç”¨ä»»ä½•å‡½æ•°éƒ½å¯èƒ½å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºï¼Œæˆ‘ä»¬é€šå¸¸ä¸åšè¿™äº›äº‹æƒ…åªæ˜¯çº¦å®šä¿—æˆï¼ˆå’Œæ–¹ä¾¿ï¼‰çš„é—®é¢˜ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123abc&quot;</span><span class="n">s</span><span class="p">;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">vec</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">vec</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">s</span><span class="p">));</span>

<span class="c1">// åœ¨moveåï¼Œsä»ç„¶æ˜¯å¯ç”¨çš„ï¼Œè¿™ä¸rustéå¸¸ä¸åŒ</span>
</code></pre></div>
<p>åœ¨Rustä¸­ TODO:</p>
<h2 id="forwarding-reference">Forwarding Reference</h2>
<p>å¦‚æœä¸€ä¸ªç±»å‹å ä½ç¬¦ P éœ€è¦è¢«ç±»å‹æ¨å¯¼ï¼Œé‚£ä¹ˆ<code>P&amp;&amp;</code> å°†æˆä¸ºC++ ä¸­ é™¤äº† å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ ä¹‹å¤–çš„å¦ä¸€ç§å¼•ç”¨ï¼š è½¬å‘å¼•ç”¨ forwarding reference</p>
<p>ä¾‹å¦‚ï¼Œåœ¨æ¨¡æ¿å‡½æ•°ä¸­ï¼Œ<code>T&amp;&amp;</code> æ˜¯ forwarding reference è€Œä¸æ˜¯å³å€¼å¼•ç”¨ï¼› ç±»ä¼¼åœ°ï¼Œ auto&amp;&amp; å§‹ç»ˆæ˜¯ä¸€ä¸ª forwarding referenceã€‚</p>
<p>è½¬å‘å¼•ç”¨<strong>ä¿ç•™å®ƒä»¬åˆå§‹åŒ–æ—¶ä½¿ç”¨çš„è¡¨è¾¾å¼çš„å€¼ç±»åˆ«</strong>ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¼ é€’ç»™å…¶ä»–å‡½æ•°æ—¶ä¿ç•™ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœè¢«ç»‘å®šçš„ value æ˜¯ä¸€ä¸ª å³å€¼/å³å€¼å¼•ç”¨ï¼Œ åˆ™<code>T&amp;&amp;</code>æˆä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå¦‚æœè¢«ç»‘å®šçš„valueæ˜¯ä¸€ä¸ªå·¦å€¼/å·¦å€¼å¼•ç”¨ï¼Œåˆ™<code>T&amp;&amp;</code> ä¼šæˆä¸ºä¸€ä¸ªå·¦å€¼å¼•ç”¨ï¼ˆåŠ ä¸Šconst åŒç†ï¼‰ã€‚</p>
<p>å¼•ç”¨æŠ˜å å’Œ template argument deduction rules æ„æˆäº†è½¬å‘å¼•ç”¨çš„è¯­æ³•è§„åˆ™ï¼š</p>
<h3 id="reference-collapsing">å¼•ç”¨æŠ˜å (Reference collapsing)</h3>
<p>å¯¹å³å€¼å¼•ç”¨çš„å³å€¼å¼•ç”¨æŠ˜å ä¸ºå³å€¼å¼•ç”¨ï¼Œæ‰€æœ‰å…¶ä»–ç»„åˆå½¢æˆå·¦å€¼å¼•ç”¨ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w">  </span><span class="n">lref</span><span class="p">;</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rref</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>

<span class="n">lref</span><span class="o">&amp;</span><span class="w">  </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c1">// type of r1 is int&amp;</span>
<span class="n">lref</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c1">// type of r2 is int&amp;</span>
<span class="n">rref</span><span class="o">&amp;</span><span class="w">  </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c1">// type of r3 is int&amp;</span>
<span class="n">rref</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// type of r4 is int&amp;&amp;</span>
</code></pre></div>
<p>å› æ­¤å¯¹äºä»¥ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="n">s</span><span class="p">;</span>
<span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sr</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>

<span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">               </span><span class="c1">// string&amp;</span>
<span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sr</span><span class="p">;</span><span class="w">              </span><span class="c1">// string&amp;</span>
<span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scr</span><span class="p">;</span><span class="w">             </span><span class="c1">// const string&amp;</span>
<span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="n">s</span><span class="p">;</span><span class="w">          </span><span class="c1">// string&amp;&amp;</span>
<span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">    </span><span class="c1">// string&amp;&amp;</span>

<span class="c1">// T&amp;&amp; ä¸ auto&amp;&amp; éƒ½æ˜¯ &quot;è½¬å‘å¼•ç”¨&quot;</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="n">foo</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">arg</span><span class="p">){</span>
<span class="w">  </span><span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">same_as_v</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">decltype</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">&gt;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// T&amp;&amp; ä¸ auto&amp;&amp; åŒç†ï¼Œ C++20 ä¹‹åå¯ä»¥æ›´å¹¿æ³›ä½¿ç”¨autoä»£æ›¿æ¨¡æ¿å‚æ•°ï¼Œ å³ &quot;bar&quot; ä¸ &quot;foo&quot; ç­‰ä»·</span>
<span class="n">bar</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">arg</span><span class="p">){</span>
<span class="w">  </span><span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">same_as_v</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">decltype</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">&gt;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="stdforawrd">std::forawrd()</h3>
<p>Forwarding Reference çš„åº”ç”¨åœºæ™¯<strong>ä»…åœ¨æ³›å‹ç¼–ç¨‹ä¸­</strong>ï¼š</p>
<p>åœ¨æ³›å‹ç¼–ç¨‹ä¸­ä¸å‚æ•°åˆ—è¡¨ç»‘å®šçš„å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼èƒ½å¤Ÿä¿æŒå‚æ•°çš„å€¼è¯­ä¹‰è½¬å‘
ç»™å…¶ä»–çš„å‡½æ•°è°ƒç”¨ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BigObj</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">BigObj</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">  </span><span class="n">BigObj</span><span class="p">(</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">data_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span><span class="w"> </span><span class="n">len_</span><span class="p">(</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Create from raw</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">BigObj</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BigObj</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Copy constructor: const BigObj&amp;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">len_</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">len_</span><span class="p">;</span>
<span class="w">    </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">len_</span><span class="p">);</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">data_</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">data_</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">len_</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">BigObj</span><span class="p">(</span><span class="n">BigObj</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Move constructor: BigObj&amp;&amp;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">len_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">len_</span><span class="p">;</span>
<span class="w">    </span><span class="n">data_</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">data_</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">BigObj</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BigObj</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Copy assignment: const BigObj&amp;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">len_</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">len_</span><span class="p">;</span>
<span class="w">    </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">len_</span><span class="p">);</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">data_</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">data_</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">len_</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">BigObj</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">BigObj</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Move assignment: BigObj&amp;&amp;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">len_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">len_</span><span class="p">;</span>
<span class="w">    </span><span class="n">data_</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">data_</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data_</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">len_</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<span class="k">concept</span><span class="w"> </span><span class="nc">same_rcv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">remove_cvref_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">V</span><span class="o">&gt;</span>
<span class="w">    </span><span class="k">requires</span><span class="w"> </span><span class="n">same_rcv</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">BigObj</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">remove_cvref_t</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">BigObj</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">             </span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">remove_cvref_t</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">BigObj</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">A</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">v1_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span><span class="w"> </span><span class="c1">// ä½¿ç”¨std::forward æ ¹æ®å…¥å‚çš„value category è°ƒç”¨BigObj çš„move or copy æ„é€ </span>
<span class="w">    </span><span class="n">v2_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span><span class="w"> </span><span class="c1">// ä½¿ç”¨std::forward æ ¹æ®å…¥å‚çš„value category è°ƒç”¨BigObj çš„move or copy æ„é€ </span>
<span class="w">    </span><span class="n">v3_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span><span class="w"> </span><span class="c1">// ä½¿ç”¨std::forward æ ¹æ®å…¥å‚çš„value category è°ƒç”¨BigObj çš„move or copy æ„é€ </span>
<span class="w">  </span><span class="p">}</span>

<span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="n">BigObj</span><span class="w"> </span><span class="n">v1_</span><span class="p">;</span>
<span class="w">  </span><span class="n">BigObj</span><span class="w"> </span><span class="n">v2_</span><span class="p">;</span>
<span class="w">  </span><span class="n">BigObj</span><span class="w"> </span><span class="n">v3_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">len</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_unique_for_overwrite</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">obj1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">BigObj</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w">  </span><span class="c1">// Create from raw</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">obj2</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obj1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Copy constructor! Not copy assignment operator!</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">obj3</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obj1</span><span class="p">;</span><span class="w">  </span><span class="c1">// copy constructor too</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">obj4</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obj1</span><span class="p">;</span><span class="w">  </span><span class="c1">// copy constructor too</span>
<span class="w">  </span><span class="n">BigObj</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">obj4</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">obj5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span><span class="w">  </span><span class="c1">// Copy constructor !!!!! (å…·åå³å€¼å¼•ç”¨æ˜¯å·¦å€¼)</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">obj2</span><span class="p">),</span><span class="w"> </span><span class="n">obj3</span><span class="p">);</span><span class="w"> </span><span class="c1">// [copy, move, copy] constructor</span>
<span class="p">}</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.indexes"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>