
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="rust-toolchain.html">
      
      
        <link rel="next" href="rust-attributes.html">
      
      <link rel="icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>rust-study - Cat538's Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rust" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Cat538&#39;s Blog" class="md-header__button md-logo" aria-label="Cat538's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cat538's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              rust-study
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Cat538&#39;s Blog" class="md-nav__button md-logo" aria-label="Cat538's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cat538's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Prologue
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plan.html" class="md-nav__link">
        Exercise
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Cpp
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Cpp
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/toolchain.html" class="md-nav__link">
        toolchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/move.html" class="md-nav__link">
        move
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/align.html" class="md-nav__link">
        align
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/ranges.html" class="md-nav__link">
        ranges
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/benchmark.html" class="md-nav__link">
        benchmark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/profiler.html" class="md-nav__link">
        profiler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/IO-multiplexing.html" class="md-nav__link">
        IO-multiplexing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/epoll.html" class="md-nav__link">
        epoll
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/signal.html" class="md-nav__link">
        signal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/fork-safe.html" class="md-nav__link">
        fork-safe
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Rust
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Rust
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rust-toolchain.html" class="md-nav__link">
        rust-toolchain
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          rust-study
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="rust-study.html" class="md-nav__link md-nav__link--active">
        rust-study
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    变量
  </a>
  
    <nav class="md-nav" aria-label="变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#const" class="md-nav__link">
    const
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    数据类型
  </a>
  
    <nav class="md-nav" aria-label="数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integer" class="md-nav__link">
    关于 integer的溢出：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#char" class="md-nav__link">
    char类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compound" class="md-nav__link">
    复合数据类型(compound)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    函数
  </a>
  
    <nav class="md-nav" aria-label="函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statement-expression" class="md-nav__link">
    语句statement 和 表达式expression
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ownership" class="md-nav__link">
    Ownership(所有权)
  </a>
  
    <nav class="md-nav" aria-label="Ownership(所有权)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#referenceborrowing" class="md-nav__link">
    引用(reference)和借用(borrowing)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macro" class="md-nav__link">
    Macro(宏)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    String
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-conversion" class="md-nav__link">
    Type Conversion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errors" class="md-nav__link">
    Errors
  </a>
  
    <nav class="md-nav" aria-label="Errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    错误处理指导原则
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-match" class="md-nav__link">
    Pattern match
  </a>
  
    <nav class="md-nav" aria-label="Pattern match">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 匹配命名变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 多个模式&amp;范围匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 解构匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. @ 绑定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trait" class="md-nav__link">
    Trait
  </a>
  
    <nav class="md-nav" aria-label="Trait">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trait_1" class="md-nav__link">
    trait 作为参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    where
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    生命周期
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifetime-elision" class="md-nav__link">
    生命周期省略（Lifetime Elision）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    静态生命周期
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    多线程
  </a>
  
    <nav class="md-nav" aria-label="多线程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    消息传递
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rustling-alias" class="md-nav__link">
    Rustling-别名（alias）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rust-monad" class="md-nav__link">
    Rust monad
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rust-attributes.html" class="md-nav__link">
        rust-attributes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rust-modules.html" class="md-nav__link">
        rust-modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rust-macro.html" class="md-nav__link">
        rust-macro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rust-network.html" class="md-nav__link">
        rust-network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rust-option.html" class="md-nav__link">
        rust-optin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rust-str.html" class="md-nav__link">
        rust-str
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/cmake.html" class="md-nav__link">
        cmake
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/docker.html" class="md-nav__link">
        docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/git.html" class="md-nav__link">
        git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/powershell.html" class="md-nav__link">
        powershell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/regex.html" class="md-nav__link">
        regex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/mkdocs.html" class="md-nav__link">
        mkdocs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Courses
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Courses
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/%E5%AF%86%E7%A0%81%E5%88%86%E6%9E%90%E5%AD%A6%E5%A4%8D%E4%B9%A0.html" class="md-nav__link">
        密码分析学
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%BC%95%E8%AE%BA%E5%A4%8D%E4%B9%A0.html" class="md-nav__link">
        密码学引论
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/algorithm.html" class="md-nav__link">
        算法设计与分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../courses/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html" class="md-nav__link">
        编译原理
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Crypto
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Crypto
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/ecdsa-pk-recovery.html" class="md-nav__link">
        ecdsa-pk-recovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/algo-rsa.html" class="md-nav__link">
        algo-rsa
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/algo-fft%26ntt.html" class="md-nav__link">
        algo-fft&ntt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crypto/algo-reduction.html" class="md-nav__link">
        algo-reduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Mlc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Mlc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/dlc-survey.html" class="md-nav__link">
        dlc-survey
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-install.html" class="md-nav__link">
        tvm-install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-ffi.html" class="md-nav__link">
        tvm-ffi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-type.html" class="md-nav__link">
        tvm-type
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-tensorIR.html" class="md-nav__link">
        tvm-tensorIR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-lowering.html" class="md-nav__link">
        tvm-lowering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-autotvm.html" class="md-nav__link">
        tvm-autotvm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/tvm-ansor.html" class="md-nav__link">
        tvm-ansor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir.html" class="md-nav__link">
        mlir
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir-toy.html" class="md-nav__link">
        mlir-toy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir-onnx.html" class="md-nav__link">
        mlir-onnx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/mlir-iree.html" class="md-nav__link">
        mlir-iree
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-torch.fx.html" class="md-nav__link">
        paper-torch.fx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-nimble.html" class="md-nav__link">
        paper-nimble
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-disc.html" class="md-nav__link">
        paper-disc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-cortex.html" class="md-nav__link">
        paper-cortex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mlc/paper-freetensor.html" class="md-nav__link">
        paper-freetensor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about.html" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    变量
  </a>
  
    <nav class="md-nav" aria-label="变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#const" class="md-nav__link">
    const
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    数据类型
  </a>
  
    <nav class="md-nav" aria-label="数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integer" class="md-nav__link">
    关于 integer的溢出：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#char" class="md-nav__link">
    char类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compound" class="md-nav__link">
    复合数据类型(compound)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    函数
  </a>
  
    <nav class="md-nav" aria-label="函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statement-expression" class="md-nav__link">
    语句statement 和 表达式expression
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ownership" class="md-nav__link">
    Ownership(所有权)
  </a>
  
    <nav class="md-nav" aria-label="Ownership(所有权)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#referenceborrowing" class="md-nav__link">
    引用(reference)和借用(borrowing)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macro" class="md-nav__link">
    Macro(宏)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    String
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-conversion" class="md-nav__link">
    Type Conversion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errors" class="md-nav__link">
    Errors
  </a>
  
    <nav class="md-nav" aria-label="Errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    错误处理指导原则
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-match" class="md-nav__link">
    Pattern match
  </a>
  
    <nav class="md-nav" aria-label="Pattern match">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 匹配命名变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 多个模式&amp;范围匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 解构匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. @ 绑定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trait" class="md-nav__link">
    Trait
  </a>
  
    <nav class="md-nav" aria-label="Trait">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trait_1" class="md-nav__link">
    trait 作为参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    where
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    生命周期
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifetime-elision" class="md-nav__link">
    生命周期省略（Lifetime Elision）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    静态生命周期
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    多线程
  </a>
  
    <nav class="md-nav" aria-label="多线程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    消息传递
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rustling-alias" class="md-nav__link">
    Rustling-别名（alias）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rust-monad" class="md-nav__link">
    Rust monad
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="rust">Rust 入门记录</h1>
<h2 id="_1">变量</h2>
<h3 id="const">const</h3>
<p><strong>定义常量使用const而不是let</strong></p>
<p>Rust 中<code>let</code>定义的 Variable 虽然默认不可变，但是与const还是存在区别：</p>
<ul>
<li>constant 的生命周期是整个作用域</li>
<li>编译器可以推断 variable 的类型，但是定义 constant 必须显式声明类型</li>
</ul>
<p>constant必须使用 <code>constant expression</code> 来设置，如：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 1. 常量表达式</span>
<span class="k">const</span><span class="w"> </span><span class="n">LEN</span>: <span class="kt">usize</span> <span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="mi">16</span><span class="p">;</span>
<span class="c1">// 2. const fn</span>
<span class="k">impl</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="w"> </span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">A</span><span class="p">{</span>
<span class="w">            </span><span class="n">a</span>: <span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="n">b</span>: <span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="n">c</span>: <span class="mi">0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">const</span><span class="w"> </span><span class="n">TST</span>: <span class="nc">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span>::<span class="n">new</span><span class="p">();</span>
</code></pre></div>
<h2 id="_2">数据类型</h2>
<p>rust 有两种数据类型： scalar and compound，即所谓简单类型和复合类型</p>
<blockquote>
<p>记住 Rust is a <strong>statically typed language</strong>, 这意味着rust需要在编译期知道所有变量的类型（想想js或python?）</p>
</blockquote>
<p><strong>Scalar：</strong></p>
<ul>
<li>
<p>integers, </p>
</li>
<li>
<p>floating-point numbers, </p>
</li>
<li>
<p>Booleans, and </p>
</li>
<li>
<p>characters</p>
</li>
</ul>
<h3 id="integer">关于 integer的溢出：</h3>
<ul>
<li>
<p>debug模式编译时：rust执行integer overflow chek。如果程序运行时发生整数溢出，会直接panic；</p>
</li>
<li>
<p>release模式编译时(<code>cargo build --release</code>)：rust不执行integer overflow check。如果程序运行时发生整数溢出，将进行wrap（与C语言默认行为相同），即，大于该类型最大值的数值将会“wrap around”到该类型可以容纳的最小值。在 u8 的情况下，256 变为 0，257 变为 1，依此类推。</p>
<p>如果要显式wrap，可以使用标准库类型 <code>Wrapping</code>（<strong>但是，可能是我眼界窄，从未见人使用过</strong>）：
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wrapping</span><span class="p">(</span><span class="mi">0</span><span class="k">u8</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">tff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wrapping</span><span class="p">(</span><span class="mi">255</span><span class="k">u8</span><span class="p">);</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tff</span><span class="p">);</span>
<span class="c1">// 254</span>
</code></pre></div></p>
</li>
</ul>
<h3 id="char">char类型</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>关于字符和字符串类型，更详细的解释见<a href="rust-str.html">rust-str</a></p>
</div>
<p>与C语言中的简单使用8位有符号整型来代表<code>char</code>类型不同：</p>
<p>Rust 中 <code>char</code> 类型是4字节，并且每个字符表示一个 <code>Unicode Scalar Value</code>,which means it can represent a lot more than just ASCII.</p>
<blockquote>
<p>Unicode Scalar Values range from <code>U+0000</code> to <code>U+D7FF</code> and <code>U+E000</code> to <code>U+10FFFF</code> inclusive</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;端&#39;</span><span class="p">;</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{} is {} bytes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">size_of_val</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">));</span>
<span class="c1">// 端 is 4 bytes</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">4</span><span class="p">];</span>
<span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;端&#39;</span><span class="p">.</span><span class="n">encode_utf8</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">&quot;result len: {} bytes&quot;</span><span class="p">,</span><span class="n">result</span><span class="p">.</span><span class="n">len</span><span class="p">());</span>
<span class="c1">// result len: 3 bytes</span>
<span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;d&#39;</span><span class="p">.</span><span class="n">encode_utf8</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">&quot;result len: {} bytes&quot;</span><span class="p">,</span><span class="n">result</span><span class="p">.</span><span class="n">len</span><span class="p">());</span>
<span class="c1">// result len: 1 bytes</span>
</code></pre></div>
<p>可以看到编码成utf-8之后，一个中文占3个字节，英文占一个字节。</p>
<h3 id="compound">复合数据类型(compound)</h3>
<p><strong>tuple：</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Furry McFurson&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cat</span><span class="p">;</span>
<span class="fm">print!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{} is {} years old.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">);</span>
</code></pre></div>
<h2 id="_3">函数</h2>
<blockquote>
<p>Function bodies are made up of a series of <strong>statements</strong> optionally ending in an <strong>expression</strong>. </p>
</blockquote>
<h3 id="statement-expression">语句statement 和 表达式expression</h3>
<blockquote>
<p><strong>TL;DR:</strong> <em>Statements</em>  <strong>do not</strong> return a value. <em>Expressions</em> evaluate to a resulting value. </p>
<p>Rust is an <strong>expression-based language</strong>, this is an important distinction to understand. Other languages don’t have the same distinctions, so let’s look at what statements and expressions are and how their differences affect the bodies of functions.
</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
</code></pre></div>
<p><code>let y = 6</code>语句不返回值，所以 x 没有任何东西可以绑定。这与其他语言（例如 C 和 Ruby）中发生的情况不同，C的赋值语句返回赋值的值，因此可以写<code>int x = y = 3</code>（这也是为什么C++中，为一个自定义class定义<code>operator=</code>需要返回<code>Object&amp;</code>），而在rust是不可行的。</p>
<p>表达式可以是语句的一部分：<code>let y = 6</code>中的<code>6</code>是一个表达式，它计算出的值是<code>6</code>；函数调用是一个表达式；宏调用是一个表达式；我们用来创建新作用域的大括号（代码块） <code>{}</code> 也是一个表达式，例如：
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;The value of y is: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="ownership">Ownership(所有权)</h2>
<ul>
<li>
<p>分配和访问 stack上的数据快于heap上的数据</p>
<blockquote>
<p><strong>Pushing to the stack is faster than allocating on the heap</strong>。因为分配栈变量不必搜索存储新数据的位置；只需要移动栈顶指针（ESP）。相比之下，在堆上分配空间需要更多的工作，因为分配器必须首先找到足够大的空间来存放数据，然后进行标记，为下一次分配做准备。</p>
<p><strong>Accessing data in the heap is slower than accessing data on the stack</strong>。
主要是cache的原因，在内存中跳动小，局部性好，速度就会更快。同样的道理，在堆上分配大量的空间也会花费时间。</p>
</blockquote>
</li>
</ul>
<p>所有权的规则：</p>
<ul>
<li>Rust 中的每一个值都有一个被称为其 所有者（owner）的变量。</li>
<li>值在任一时刻有且只有一个所有者。</li>
<li>当所有者（变量）离开作用域，这个值将被丢弃。</li>
</ul>
<p><strong>考虑C++中的<code>unique_ptr</code></strong></p>
<h3 id="referenceborrowing">引用(reference)和借用(borrowing)</h3>
<div class="admonition note">
<p class="admonition-title">TL;DR</p>
<p>关于引用的两个条件：</p>
<ul>
<li>在任意给定时间，要么 只能有一个可变引用，要么 只能有多个不可变引用。</li>
<li>引用必须总是有效的(编译器检查并禁止Dangling References)。</li>
</ul>
</div>
<blockquote>
<p>我们将创建一个引用的行为称为 借用（borrowing）</p>
</blockquote>
<p>多数情况下，我们更希望能访问数据，同时不取得其所有权。为实现这点，Rust 使用 了<strong>借用</strong>（borrowing）机制。对象可以通过引用（<code>&amp;T</code>）来传递，从而取代通过 值（<code>T</code>）来传递。</p>
<p><strong>另外需要注意的一点是：</strong></p>
<p>一个数据可以有多个不可变借用，但是在使用数据的不可变借用的同时，不能使用数据的可变借用。</p>
<p>或者说，同一时间内只允许<strong>一个</strong>可变借用。仅当最后一次使用可变借用<strong>之后</strong>，原始数据才可以再次借用。如下例子：</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">z</span>: <span class="kt">i32</span> <span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">z</span>: <span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">borrowed_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">point</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">another_borrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">point</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// 数据可以通过引用或原始类型来访问</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Point has coordinates: ({}, {}, {})&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">borrowed_point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">another_borrow</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">z</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="c1">// 报错！`point` 不能以可变方式借用，因为当前还有不可变借用。</span>
<span class="w">    </span><span class="c1">// let mutable_borrow = &amp;mut point;</span>
<span class="w">    </span><span class="c1">// TODO ^ 试一试去掉此行注释</span>

<span class="w">    </span><span class="c1">// 被借用的值在这里被重新使用</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Point has coordinates: ({}, {}, {})&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">borrowed_point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">another_borrow</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// 不可变的引用不再用于其余的代码，因此可以使用可变的引用重新借用。</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">mutable_borrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">point</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// 通过可变引用来修改数据</span>
<span class="w">    </span><span class="n">mutable_borrow</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="n">mutable_borrow</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="n">mutable_borrow</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// 报错！不能再以不可变方式来借用 `point`，因为它当前已经被可变借用。</span>
<span class="w">    </span><span class="c1">// let y = &amp;point.y;</span>
<span class="w">    </span><span class="c1">// TODO ^ 试一试去掉此行注释</span>

<span class="w">    </span><span class="c1">// 报错！无法打印，因为 `println!` 用到了一个不可变引用。</span>
<span class="w">    </span><span class="c1">// println!(&quot;Point Z coordinate is {}&quot;, point.z);</span>
<span class="w">    </span><span class="c1">// TODO ^ 试一试去掉此行注释</span>

<span class="w">    </span><span class="c1">// 正常运行！可变引用能够以不可变类型传入 `println!`</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Point has coordinates: ({}, {}, {})&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">mutable_borrow</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mutable_borrow</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">mutable_borrow</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 可变引用不再用于其余的代码，因此可以重新借用</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">new_borrowed_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">point</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Point now has coordinates: ({}, {}, {})&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="n">new_borrowed_point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">new_borrowed_point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">new_borrowed_point</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="macro">Macro(宏)</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>这一部分详细信息见<a href="rust-macro.html">rust-macro</a></p>
</div>
<p><strong>关于macro的声明位置：</strong></p>
<blockquote>
<p>In order to use a macro outside of its module, you need to do something special to the module to lift the macro out into its parent.</p>
<p>The same trick also works on "extern crate" statements for crates that have exported macros, if you've seen any of those around.</p>
</blockquote>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[macro_export]</span>
<span class="k">mod</span> <span class="nn">macros</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">my_macro</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Check out my macro!&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">my_macro</span><span class="o">!</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>必须使用<code>#[macro_export]</code>，而不能<code>macros::my_macro!()</code></p>
<h2 id="string">String</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>关于字符和字符串类型，更详细的解释见<a href="rust-str.html">rust-str</a></p>
</div>
<p>string不能使用 index。</p>
<p>rust中的String存储方式：</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[derive(PartialOrd, Eq, Ord)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nb">String</span> <span class="p">{</span>
<span class="w">    </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>在<code>string.rs</code>中可以很清楚的看到，String只是对<code>Vec&lt;u8&gt;</code>做了一个包装</p>
<p>因此 从 Rust 的角度来讲，事实上有三种相关方式可以理解字符串：字节、标量值和字形簇（最接近人们眼中 <strong>字母</strong> 的概念）。</p>
<h2 id="type-conversion">Type Conversion</h2>
<h2 id="errors">Errors</h2>
<p>使用backtrace：</p>
<p>在powershell中：</p>
<div class="highlight"><pre><span></span><code><span class="nv">$env</span>:RUST_BACKTRACE<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>cargo<span class="w"> </span>run
</code></pre></div>
<p>在linux 终端中：</p>
<div class="highlight"><pre><span></span><code><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>cargo<span class="w"> </span>run
</code></pre></div>
<h3 id="_4">错误处理指导原则</h3>
<p>在当有可能会导致有害状态的情况下建议使用 <code>panic!</code> —— 有害状态是指当一些假设、保证、协议或不可变性被打破的状态，例如无效的值、自相矛盾的值或者被传递了不存在的值 —— 外加如下几种情况：</p>
<p>有害状态是非预期的行为，与偶尔会发生的行为相对，比如用户输入了错误格式的数据。
在此之后代码的运行依赖于不处于这种有害状态，而不是在每一步都检查是否有问题。
没有可行的手段来将有害状态信息编码进所使用的类型中的情况。我们会在第十七章 “将状态和行为编码为类型” 部分通过一个例子来说明我们的意思。
如果别人调用你的代码并传递了一个没有意义的值，最好的情况也许就是<code>panic!</code>并警告使用你的库的人他的代码中有 bug 以便他能在开发时就修复它。类似的，如果你正在调用不受你控制的外部代码，并且它返回了一个你无法修复的无效状态，那么 <code>panic!</code> 往往是合适的。</p>
<p>然而当错误预期会出现时，返回 <code>Result</code> 仍要比调用 <code>panic!</code> 更为合适。这样的例子包括解析器接收到格式错误的数据，或者 HTTP 请求返回了一个表明触发了限流的状态。在这些例子中，应该通过返回 <code>Result</code> 来表明失败预期是可能的，这样将有害状态向上传播，调用者就可以决定该如何处理这个问题。使用 <code>panic!</code> 来处理这些情况就不是最好的选择。</p>
<h2 id="pattern-match">Pattern match</h2>
<p>下面介绍模式匹配的所有语法</p>
<h3 id="1">1. 匹配命名变量</h3>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Got 50&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Matched, y = {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Default case, x = {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;at the end: x = {:?}, y = {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>​   让我们看看当 <code>match</code> 语句运行的时候发生了什么。第一个匹配分支的模式并不匹配 <code>x</code> 中定义的值，所以代码继续执行。</p>
<p>​   第二个匹配分支中的模式引入了一个新变量 <code>y</code>，它会匹配任何 <code>Some</code> 中的值。因为我们在 <code>match</code> 表达式的新作用域中，这是一个新变量，而不是开头声明为值 10 的那个 <code>y</code>。这个新的 <code>y</code> 绑定会匹配任何 <code>Some</code> 中的值，在这里是 <code>x</code> 中的值。因此这个 <code>y</code> 绑定了 <code>x</code> 中 <code>Some</code> 内部的值。这个值是 5，所以这个分支的表达式将会执行并打印出 <code>Matched, y = 5</code>。</p>
<p><strong><code>match</code> 会开始一个新作用域</strong></p>
<h3 id="2">2. 多个模式&amp;范围匹配</h3>
<ul>
<li>在 <code>match</code> 表达式中，可以使用 <code>|</code> 语法匹配多个模式，它代表 <strong>或</strong>（<em>or</em>）的意思。</li>
<li><code>..=</code> 语法允许你匹配一个闭区间范围内的值。（<strong>注意只允许闭区间</strong>）</li>
</ul>
<h3 id="3">3. 解构匹配</h3>
<p>结构匹配元组、枚举、结构体等</p>
<div class="highlight"><pre><span></span><code><span class="k">enum</span> <span class="nc">Message</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Quit</span><span class="p">,</span>
<span class="w">    </span><span class="n">Move</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kt">i32</span> <span class="p">},</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
<span class="w">    </span><span class="n">ChangeColor</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span>::<span class="n">ChangeColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">160</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">);</span>

<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Message</span>::<span class="n">Quit</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;The Quit variant has no data to destructure.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Message</span>::<span class="n">Move</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="c1">//解构匹配结构体</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;Move in the x direction {} and in the y direction {}&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">x</span><span class="p">,</span>
<span class="w">                </span><span class="n">y</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Message</span>::<span class="n">Write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Text message: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">),</span><span class="c1">//普通的匹配</span>
<span class="w">        </span><span class="n">Message</span>::<span class="n">ChangeColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="c1">//解构匹配元组</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;Change the color to red {}, green {}, and blue {}&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">r</span><span class="p">,</span>
<span class="w">                </span><span class="n">g</span><span class="p">,</span>
<span class="w">                </span><span class="n">b</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>在解构匹配中，可以使用 <code>..</code> 忽略剩余值：</strong></p>
<p>对于有多个部分的值，可以使用 <code>..</code> 语法来只使用部分并忽略其它值，同时避免不得不每一个忽略值列出下划线。<code>..</code> 模式会忽略模式中剩余的任何没有显式匹配的值部分。在示例 18-23 中，有一个 <code>Point</code> 结构体存放了三维空间中的坐标。在 <code>match</code> 表达式中，我们希望只操作 <code>x</code> 坐标并忽略 <code>y</code> 和 <code>z</code> 字段的值：</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span>
<span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span>
<span class="w">    </span><span class="n">z</span>: <span class="kt">i32</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">z</span>: <span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="k">match</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;x is {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4">4. @ 绑定</h3>
<p><em>at</em> 运算符（<code>@</code>）允许我们在创建一个存放值的变量的同时测试其值是否匹配模式。示例 18-29 展示了一个例子，这里我们希望测试 <code>Message::Hello</code> 的 <code>id</code> 字段是否位于 <code>3..=7</code> 范围内，同时也希望能将其值绑定到 <code>id_variable</code> 变量中以便此分支相关联的代码可以使用它。可以将 <code>id_variable</code> 命名为 <code>id</code>，与字段同名，不过出于示例的目的这里选择了不同的名称。</p>
<h2 id="trait">Trait</h2>
<h3 id="trait_1">trait 作为参数</h3>
<p>知道了如何定义 trait 和在类型上实现这些 trait 之后，我们可以探索一下如何使用 trait 来接受多种不同类型的参数。</p>
<p>示例中为 <code>NewsArticle</code> 和 <code>Tweet</code> 类型实现了 <code>Summary</code> trait。我们可以定义一个函数 <code>notify</code> 来调用其参数 <code>item</code> 上的 <code>summarize</code> 方法，该参数是实现了 <code>Summary</code> trait 的某种类型。为此可以使用 <code>impl Trait</code> 语法，像这样：</p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">notify</span><span class="p">(</span><span class="n">item</span>: <span class="nc">impl</span><span class="w"> </span><span class="n">Summary</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Breaking news! {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">summarize</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>对于 <code>item</code> 参数，我们指定了 <code>impl</code> 关键字和 trait 名称，而不是具体的类型。该参数支持任何实现了指定 trait 的类型。在 <code>notify</code> 函数体中，可以调用任何来自 <code>Summary</code> trait 的方法，比如 <code>summarize</code>。我们可以传递任何 <code>NewsArticle</code> 或 <code>Tweet</code> 的实例来调用 <code>notify</code>。任何用其它如 <code>String</code> 或 <code>i32</code> 的类型调用该函数的代码都不能编译，因为它们没有实现 <code>Summary</code>。</p>
<p><strong><code>impl Trait</code> 语法适用于直观的例子，它不过是一个较长形式的语法糖。这被称为 <em>trait bound</em>，这看起来像：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">notify</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Summary</span><span class="o">&gt;</span><span class="p">(</span><span class="n">item</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Breaking news! {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">summarize</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>这与之前的例子相同，不过稍微冗长了一些。trait bound 与泛型参数声明在一起，位于尖括号中的冒号后面。</p>
<h3 id="where">where</h3>
<p>Rust 有另一个在函数签名之后的 <code>where</code> 从句中指定 trait bound 的语法。所以除了这么写：</p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">some_function</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Display</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span><span class="w"> </span><span class="n">U</span>: <span class="nb">Clone</span> <span class="o">+</span><span class="w"> </span><span class="n">Debug</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">u</span>: <span class="nc">U</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span>
</code></pre></div>
<p>还可以像这样使用 <code>where</code> 从句：</p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">some_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">u</span>: <span class="nc">U</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span>
    <span class="nc">where</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Display</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span>
<span class="w">          </span><span class="n">U</span>: <span class="nb">Clone</span> <span class="o">+</span><span class="w"> </span><span class="n">Debug</span>
<span class="p">{</span>
</code></pre></div>
<p>这个函数签名就显得不那么杂乱，函数名、参数列表和返回值类型都离得很近，看起来类似没有很多 trait bounds 的函数。</p>
<h3 id="_5">生命周期</h3>
<p>每一个引用都有一个生命周期。</p>
<p>生命周期在函数中用来解决悬垂引用的问题：即函数返回一个引用，Rust要保证这个引用是有效的</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">longest</span><span class="p">(</span><span class="n">x</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">str</span> <span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">y</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>将不能被编译通过，因为 x or y都有可能是一个悬垂引用，考虑以下情况：</p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">string1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;xyz&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">string2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;long string is long&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longest</span><span class="p">(</span><span class="n">string1</span><span class="p">.</span><span class="n">as_str</span><span class="p">(),</span><span class="w"> </span><span class="n">string2</span><span class="p">.</span><span class="n">as_str</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;The longest string is {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>(result为string2的引用，在离开作用域后失效)</p>
<p>当从函数返回一个引用，返回值的生命周期参数需要与一个参数的生命周期参数相匹配。</p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">longest</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span> <span class="kt">str</span> <span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;really long string&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">as_str</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>如图所示：返回的引用 <strong>没有</strong> 指向任何一个参数，那么唯一的可能就是它指向一个函数内部创建的值，它将会是一个悬垂引用，因为它将会在函数结束时离开作用域。</p>
<h3 id="lifetime-elision">生命周期省略（Lifetime Elision）</h3>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">first_word</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">str</span> <span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bytes</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">enumerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">b&#39; &#39;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="o">..</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>上述代码可以编译通过。</p>
<blockquote>
<p>这个函数没有生命周期注解却能编译是由于一些历史原因：在早期版本（pre-1.0）的 Rust 中，这的确是不能编译的。</p>
<p>在编写了很多 Rust 代码后，Rust 团队发现在特定情况下 Rust 程序员们总是重复地编写一模一样的生命周期注解。这些场景是可预测的并且遵循几个明确的模式。接着 Rust 团队就把这些模式编码进了 Rust 编译器中，如此借用检查器在这些情况下就能推断出生命周期而不再强制程序员显式的增加注解。</p>
</blockquote>
<h3 id="_6">静态生命周期</h3>
<p>这里有一种特殊的生命周期值得讨论：<code>'static</code>，其生命周期<strong>能够</strong>存活于整个程序期间。所有的字符串字面值都拥有 <code>'static</code> 生命周期，我们也可以选择像下面这样标注出来：</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">s</span>: <span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span> <span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="s">&quot;I have a static lifetime.&quot;</span><span class="p">;</span>
</code></pre></div>
<p>这个字符串的文本被直接储存在程序的二进制文件中而这个文件总是可用的。因此所有的字符串字面值都是 <code>'static</code> 的。</p>
<h2 id="_7">多线程</h2>
<p><code>spawn()</code>可以船舰一个子线程，返回一个<code>JoinHandle</code>句柄，可以使用<code>join()</code>方法进行阻塞</p>
<p><code>move</code> 闭包，经常与 <code>thread::spawn</code> 一起使用，因为它允许我们在一个线程中使用另一个线程的数据。</p>
<blockquote>
<p>在参数列表前使用 <code>move</code> 关键字<strong>强制闭包获取其使用的环境值的所有权</strong>。这个技巧在创建新线程将值的所有权从一个线程移动到另一个线程时最为实用。（<strong>这一点与C++很不同，在某种程度上于编译期杜绝了资源竞争问题</strong>）</p>
</blockquote>
<h3 id="_8">消息传递</h3>
<blockquote>
<p>一个日益流行的确保安全并发的方式是 <strong>消息传递</strong>（<em>message passing</em>），这里线程或 actor 通过发送包含数据的消息来相互沟通。这个思想来源于 <a href="http://golang.org/doc/effective_go.html">Go 编程语言文档中</a> 的口号：“不要通过共享内存来通讯；而是通过通讯来共享内存。”（“Do not communicate by sharing memory; instead, share memory by communicating.”）</p>
<p>Rust 中一个实现消息传递并发的主要工具是 <strong>通道</strong>（<em>channel</em>），Rust 标准库提供了其实现的编程概念。你可以将其想象为一个水流的通道，比如河流或小溪。如果你将诸如橡皮鸭或小船之类的东西放入其中，它们会顺流而下到达下游。</p>
</blockquote>
<h2 id="rustling-alias">Rustling-别名（alias）</h2>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">input</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">input</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">comput</span><span class="p">(</span><span class="n">input</span>:<span class="kp">&amp;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">output</span>:<span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>rust编译器可以将代码优化为，在C中则不可能做出这种优化（<strong>考虑input 和output指针指向同一地址</strong>）：</p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span> <span class="nf">comput</span><span class="p">(</span><span class="n">input</span>:<span class="kp">&amp;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">output</span>:<span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cached_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">cached_input</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// x&gt;10 则必然&gt;5，直接加倍退出</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">cached_input</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><img alt="image-20210825005100468" src="https://github.com/cat538/images-auto/raw/main/img/image-20210825005100468.png" /><img alt="image-20210825005110601" src="https://github.com/cat538/images-auto/raw/main/img/image-20210825005110601.png" /></p>
<h2 id="rust-monad">Rust monad</h2>
<p>这里以 I/O 操作为例，下面是与 ChatGPT的对话：</p>
<blockquote>
<p>🐋: what's the main difference between monad I/O style and C-like I/O style?</p>
<p>🦭: The main difference between Monad I/O style and C-like I/O style lies in the way they handle Input/Output (I/O) operations.</p>
<p>In the C-like I/O style, I/O is performed by calling functions and passing parameters, and <strong>I/O functions are typically side-effecting and can change the state of the system</strong>. For example, to read a line of text from standard input in C, you might use the fgets function, which reads a specified number of characters from an input stream into a buffer, and can change the position of the input stream's file pointer.</p>
<p>On the other hand, the Monad I/O style, which is commonly used in functional programming languages, <strong>models I/O as a computation that produces a value and possibly has a side effect</strong>. In this style, I/O operations are performed by constructing a computation, usually represented as a monad, that represents the I/O action. The monad can then <strong>be executed by a runtime system, which will perform the actual I/O</strong> and return the result to the caller.</p>
<p>One of the main advantages of the Monad I/O style is that it makes it easier to write code that is pure and composable, as it <strong>separates the description of I/O operations from their execution</strong>, which can make it easier to test and reason about the code. In contrast, C-like I/O style can make it harder to write code that is pure, as I/O functions can have side effects that change the state of the system and make it difficult to predict the outcome of a computation.</p>
</blockquote>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.indexes"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>